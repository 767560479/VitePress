# 如何优雅地回退未推送的 Commit

---

# Git 本地提交撤销指南：如何优雅地回退未推送的 Commit

> **📝 前言**  
> 在 Git 版本控制中，我们经常会遇到需要撤销本地提交的情况。例如：
>
> - 提交了错误的代码
> - 漏掉了某些文件
> - 提交信息（Commit Message）写错了
>
> **如果你还没有将提交推送（`push`）到远程仓库**，这篇文章将为你提供三种安全高效的撤销方案。即使你不小心手滑了，也能轻松挽回！

---

## 一、核心解决方案：`git reset` 三剑客

### 1. 后悔药模式：保留所有修改（`--soft`）

```bash
git reset --soft HEAD~1
```

- **适用场景**
  - 需要修改提交信息
  - 想重新组织代码变更（例如拆分/合并提交）
- **效果**
  - 撤销提交，但保留工作目录和暂存区的修改
  - 相当于按下了"撤回提交但保留代码"的后悔键

---

### 2. 半保留模式：取消暂存（`--mixed`，默认选项）

```bash
git reset HEAD~1  # 等价于 git reset --mixed HEAD~1
```

- **适用场景**
  - 需要重新选择要提交的文件（例如漏了某个文件）
  - 想检查代码后再提交
- **效果**
  - 撤销提交，保留工作目录修改
  - 但取消所有文件的暂存状态（`git add` 操作会被清除）

---

### 3. 毁灭模式：彻底删除修改（`--hard`，慎用！）

```bash
git reset --hard HEAD~1
```

- **适用场景**
  - 确定本次提交的代码完全无用
  - 需要快速回滚到干净状态
- **效果**
  - 撤销提交并**永久删除所有修改**
  - 工作目录和暂存区会完全回退到上一次提交的状态

---

## 二、操作后验证技巧

执行完 `git reset` 后，建议通过以下命令确认状态：

```bash
git log --oneline   # 查看提交历史是否缩短
git status          # 检查文件状态是否符合预期
```

---

## 三、实战案例演示

### 场景还原

1. 你修改了 `index.html` 和 `style.css`
2. 执行了 `git add .` 和 `git commit -m "Update styles"`
3. 突然发现漏了 `script.js` 文件

### 修复流程

```bash
# 1. 撤销最近提交（保留修改）
git reset --soft HEAD~1

# 2. 添加漏掉的文件
git add script.js

# 3. 重新提交
git commit -m "更新样式和脚本文件"
```

---

## 四、避坑指南 ⚠️

1. **确认未推送**  
   执行操作前务必用 `git log` 对比本地与远程仓库的提交记录，确保未推送（可通过 `git log origin/main..HEAD` 查看差异）

2. **备份大法好**  
   如果不确定操作后果，建议：

   ```bash
   git stash        # 暂存当前修改
   git stash apply  # 需要时恢复修改
   ```

3. **HEAD~N 的含义**

   - `HEAD~1`：回退 1 个提交
   - `HEAD~3`：回退 3 个提交
   - 可通过 `git reflog` 查看所有操作记录

4. **远程仓库已推送怎么办？**  
   如果误操作已经推送，只能通过强制推送覆盖：
   ```bash
   git push -f
   ```
   但会改写历史记录，可能导致协作冲突，需谨慎使用！

---

## 五、知识扩展 🔍

- **撤销的替代方案**  
  使用 `git commit --amend` 可以修改最近一次提交（合并修改到上一次提交）

- **可视化工具推荐**  
  使用 `gitk` 或 VS Code 的 GitLens 插件，可以更直观地查看提交树

---

## 六、总结

通过合理使用 `git reset`，我们可以轻松应对本地提交的各种翻车场景。记住这三个黄金口诀：

> - 想改提交信息 → `--soft`
> - 想重选提交文件 → `--mixed`
> - 想彻底删除提交 → `--hard`

**最后提醒**：对已推送的提交进行操作时，请务必与团队沟通，避免引发协作灾难！
